<!DOCTYPE html>
<html>
<head>
  <title>IPA Signer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 30px; }
    h2 { color: #333; }
    button { padding: 10px 20px; font-size: 16px; }
    #result { margin-top: 20px; }
    #installLink { display: none; margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h2>Upload your IPA for Signing</h2>
  
  <!-- Hidden UDID -->
  <input type="hidden" id="udid" value="00008140-000628e82e07801c" />

  <!-- IPA file input -->
  <input type="file" id="ipaFile" accept=".ipa" />
  <br><br>

  <!-- Upload button -->
  <button onclick="uploadIPA()">Upload & Sign</button>

  <!-- Result area -->
  <div id="result"></div>
  <a id="installLink">Install App</a>

  <script>
    async function uploadIPA() {
      const udid = document.getElementById("udid").value.trim();
      const fileInput = document.getElementById("ipaFile");

      if (fileInput.files.length === 0) {
        alert("Please select an .ipa file.");
        return;
      }

      const formData = new FormData();
      formData.append("udid", udid);
      formData.append("app", fileInput.files[0]);

      const resultDiv = document.getElementById("result");
      const installLink = document.getElementById("installLink");

      resultDiv.innerText = "Uploading...";
      installLink.style.display = "none";

      try {
        const response = await fetch("https://api.ipasigner.com/sign-app", {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          resultDiv.innerText = "Upload failed. Status: " + response.status;
          return;
        }

        const data = await response.json();

        resultDiv.innerHTML = `
          <p>âœ… Upload successful!</p>
          <p>IPA URL: <a href="${data.ipa_url}" target="_blank">${data.ipa_url}</a></p>
        `;

        // iOS install link
        installLink.href = `itms-services://?action=download-manifest&url=${encodeURIComponent(data.plist_url)}`;
        installLink.innerText = "ðŸ“² Install App on iOS";
        installLink.style.display = "block";

      } catch (err) {
        resultDiv.innerText = "Error: " + err.message;
      }
    }
  </script>
</body>
</html>
